import{r as x,t as v,j as e,D as M,h as P,i as L,k as T,l as q,I as C,n as A,B as g,o as k,y as S,z as J,g as W,s as X,E as Z,q as b,U as H,F as ee,v as f,G as se,T as te,H as ae,J as V,K as w,M as ne,N as y,O as re,x as Y,X as ie,Q as le,V as ce,W as de,Y as oe}from"./index-CnesFU-s.js";import{u as U,h as N,i as E,j as xe}from"./groupDyn-BdagIKtX.js";function me({groupId:s,groupName:d,trigger:m,onInvited:i}){const[l,o]=x.useState(!1),[r,h]=x.useState(""),[a,c]=x.useState(""),u=localStorage.getItem("userId")||"",{mutateAsync:j,isPending:p}=U({mutationFn:()=>N.inviteMembers({groupId:s,groupName:d,inviterUserId:u,invites:[{inviteeEmail:r,inviteeName:a,eventType:1}]}),onSuccess:()=>{v.success("Invitation sent"),o(!1),h(""),c(""),i==null||i()},onError:n=>{v.error((n==null?void 0:n.message)??"Failed to send invitation")}}),I=async n=>{n.preventDefault(),await j()};return e.jsxs(M,{open:l,onOpenChange:n=>!p&&o(n),children:[e.jsx(P,{asChild:!0,children:m}),e.jsx(L,{className:"sm:max-w-sm",children:e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsx(T,{children:e.jsx(q,{children:"Invite a member"})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Member Email"}),e.jsx(C,{value:r,onChange:n=>h(n.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Name (optional)"}),e.jsx(C,{value:a,onChange:n=>c(n.target.value)})]}),e.jsx(A,{children:e.jsxs(g,{type:"submit",disabled:p,children:[p&&e.jsx("span",{className:"mr-2 animate-spin",children:"⏳"}),"Send Invite"]})})]})})]})}const he=({groupId:s,trigger:d})=>{const[m,i]=x.useState(!1),[l,o]=x.useState(""),[r,h]=x.useState(!1),a=async c=>{if(c.preventDefault(),!l.trim()){S.error("Please enter an email address");return}h(!0);try{await new Promise(u=>setTimeout(u,300)),S.success("Invitation cancelled"),o(""),i(!1)}catch(u){S.error(u.message||"Failed to cancel invitation")}finally{h(!1)}};return e.jsxs(M,{open:m,onOpenChange:c=>!r&&i(c),children:[e.jsx(P,{onClick:()=>i(!0),children:d||e.jsx(g,{variant:"outline",children:"Cancel invites"})}),e.jsx(L,{children:e.jsxs("form",{onSubmit:a,className:"space-y-4",children:[e.jsx(T,{children:e.jsx(q,{children:"Cancel invitation"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-text",children:"Email address"}),e.jsx(C,{type:"email",value:l,onChange:c=>o(c.target.value),placeholder:"Enter email to cancel",required:!0}),e.jsx("p",{className:"text-xs text-gray-muted",children:"Enter the email address of the pending invitation to cancel"})]}),e.jsxs(A,{children:[e.jsx(g,{type:"button",variant:"outline",onClick:()=>i(!1),disabled:r,children:"Cancel"}),e.jsxs(g,{type:"submit",disabled:r,children:[r?e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Cancel Invite"]})]})]})})]})},$=s=>{if(!s)return"-";const d=new Date(s);return Number.isNaN(d.getTime())?s:xe(d,"MMM dd, yyyy • hh:mm a")},D=s=>`${(s==null?void 0:s.firstName)??""} ${(s==null?void 0:s.lastName)??""}`.trim()||(s==null?void 0:s.userName)||"Unknown user",ue=s=>(s==null?void 0:s.replace("GROUPUSERROLE_","").replace(/_/g," "))??"MEMBER",ge=({activity:s})=>e.jsx("div",{className:"rounded-2xl border border-white/5 bg-white/5 p-4",children:e.jsxs("div",{className:"flex flex-col gap-1 text-sm text-white/80",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs uppercase tracking-wide text-muted-foreground",children:[e.jsx("span",{children:s.eventShortName??s.eventName??"Activity"}),e.jsx("span",{children:$(s.eventStartDate)})]}),e.jsx("p",{className:"text-base font-semibold text-white",children:s.eventName??s.eventDescription}),s.eventLocation&&e.jsxs("p",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(de,{className:"h-3 w-3"}),s.eventLocation]}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx(Y,{variant:s.didIPredict?"default":"outline",className:"bg-emerald-500/20",children:s.didIPredict?"Predicted":"Spectating"}),s.didIPredict&&e.jsx(oe,{className:"h-4 w-4 text-emerald-300"})]})]})}),je=({groupId:s})=>{const[d,m]=x.useState(!1),[i,l]=x.useState(""),{mutateAsync:o,isPending:r}=U({mutationFn:async()=>{if(!i.trim())throw new Error("User ID is required");return N.leaveGroup({groupId:s,userId:i})},onSuccess:()=>{v.success("Leave request submitted"),m(!1),l("")},onError:a=>v.error(a.message||"Unable to leave clan")}),h=async a=>{a.preventDefault(),await o()};return e.jsxs(M,{open:d,onOpenChange:a=>!r&&m(a),children:[e.jsx(P,{asChild:!0,children:e.jsx(g,{variant:"outline",children:"Leave clan"})}),e.jsx(L,{className:"sm:max-w-sm",children:e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsx(T,{children:e.jsx(q,{children:"Leave this clan"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Your user ID"}),e.jsx(C,{value:i,onChange:a=>l(a.target.value),required:!0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Supply the user ID that matches your account. You can retrieve it from the profile API."})]}),e.jsx(A,{children:e.jsxs(g,{type:"submit",variant:"outline",disabled:r,children:[r?e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Confirm leave"]})})]})})]})},ve=()=>{var F,O,R,B,Q,G;const{groupId:s}=J(),d=W(),[m,i]=x.useState(null),l=E({queryKey:["group-info",s],queryFn:()=>s?N.getGroupInfo(s):Promise.reject(new Error("Missing group ID")),enabled:!!s}),o=E({queryKey:["group-activity",s],queryFn:()=>N.getGroupActivity(s),enabled:!!s}),r=E({queryKey:["group-leaderboard",s],queryFn:()=>N.getGroupLeaderboard(s),enabled:!!s}),h=U({mutationFn:t=>N.removeUsers({groupId:s,userId:[t]}),onMutate:t=>i(t),onSuccess:()=>{v.success("Member removed"),d.invalidateQueries({queryKey:["group-info",s]})},onError:t=>v.error(t.message||"Failed to remove member"),onSettled:()=>i(null)}),a=(F=l.data)==null?void 0:F.groupInfo,c=((O=l.data)==null?void 0:O.members)??[],u=((R=o.data)==null?void 0:R.activities)??[],j=x.useMemo(()=>{var t;return((t=r.data)==null?void 0:t.groupUserInfo)??[]},[(B=r.data)==null?void 0:B.groupUserInfo]),p=((Q=l.data)==null?void 0:Q.memberCount)??c.length,I=l.isPending||o.isPending||r.isPending,n=x.useMemo(()=>j[0],[j]);return s?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-[#050505] via-[#081011] to-[#040706] text-white",children:e.jsxs("main",{className:"container mx-auto max-w-6xl px-4 py-10 space-y-8",children:[e.jsxs(X,{to:"/clan",className:"inline-flex items-center gap-2 text-sm text-muted-foreground hover:text-white",children:[e.jsx(Z,{className:"h-4 w-4"}),"Back to clans"]}),e.jsx("section",{className:"rounded-3xl border border-white/10 bg-gradient-to-br from-emerald-500/10 to-transparent p-6",children:I?e.jsx(b,{className:"h-32 rounded-2xl bg-white/10"}):e.jsxs("div",{className:"flex flex-col gap-6 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm uppercase tracking-[0.5em] text-emerald-300/80",children:"Clan"}),e.jsx("h1",{className:"mt-2 text-3xl font-bold",children:(a==null?void 0:a.groupName)??"Unnamed clan"}),e.jsx("p",{className:"mt-1 text-sm text-white/60",children:a==null?void 0:a.groupAlias}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-3 text-sm text-white/80",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"h-4 w-4"}),p," members"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"h-4 w-4"}),(a==null?void 0:a.groupMode)??"PRIVATE"]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(me,{groupId:s,groupName:(a==null?void 0:a.groupName)??"",trigger:e.jsx(g,{className:"bg-emerald-500 text-white hover:bg-emerald-400",children:"Invite members"}),onInvited:()=>d.invalidateQueries({queryKey:["group-info",s]})}),e.jsx(he,{groupId:s,trigger:e.jsx(g,{variant:"outline",className:"border-white/30 text-white hover:bg-white/10",children:"Cancel invites"})}),e.jsx(je,{groupId:s})]})]})}),e.jsxs("section",{className:"grid gap-6 lg:grid-cols-[2fr,1fr]",children:[e.jsxs(f,{className:"rounded-3xl border-white/10 bg-white/5 overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-[#00ff73]/30 rounded-full -mr-16 -mt-16 pointer-events-none blur-lg"}),e.jsxs("div",{className:"p-6 relative z-10",children:[e.jsxs("h2",{className:"flex items-center gap-2 text-xl font-bold text-white mb-6",children:[e.jsx(se,{className:"h-5 w-5 text-primary"}),"Live leaderboard"]}),r.isPending?e.jsx(b,{className:"h-48 rounded-2xl bg-white/10"}):j.length?e.jsxs(te,{children:[e.jsx(ae,{children:e.jsxs(V,{className:"border-white/5 text-xs uppercase tracking-wide",children:[e.jsx(w,{className:"text-white",children:"Member"}),e.jsx(w,{className:"text-right text-white",children:"Accuracy"}),e.jsx(w,{className:"text-right text-white",children:"Earnings"}),e.jsx(w,{className:"text-right text-white",children:"Predictions"})]})}),e.jsx(ne,{children:j.map((t,_)=>{var K,z;return e.jsxs(V,{className:"border-white/5",children:[e.jsxs(y,{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-white",children:D(t.userInfo)}),e.jsx("span",{className:"text-xs text-muted-foreground",children:(K=t.userInfo)==null?void 0:K.userEmail})]}),e.jsx(y,{className:"text-right text-white/80",children:t.accuracy??"-"}),e.jsx(y,{className:"text-right text-emerald-300",children:t.earnings??"-"}),e.jsx(y,{className:"text-right text-white/80",children:t.predictions??0})]},((z=t.userInfo)==null?void 0:z.userId)??_)})})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No leaderboard data yet."})]})]}),e.jsxs(f,{className:"rounded-3xl border-white/10 bg-white/5 overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-[#00ff73]/30 rounded-full -mr-16 -mt-16 pointer-events-none blur-lg"}),e.jsxs("div",{className:"p-6 relative z-10",children:[e.jsxs("h2",{className:"flex items-center gap-2 text-xl font-bold text-white mb-6",children:[e.jsx(H,{className:"h-5 w-5 text-primary"}),"Members"]}),l.isPending?e.jsx(b,{className:"h-64 rounded-2xl bg-white/10"}):e.jsx(re,{className:"max-h-72 pr-4",children:e.jsxs("div",{className:"space-y-3",children:[c.map(t=>e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-white/5 bg-white/5 p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-white",children:D(t)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.userEmail??t.userName})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{variant:"outline",className:"border-white/30 text-white",children:ue(t.userRole)}),e.jsx("button",{className:"text-red-400 hover:text-red-300 disabled:opacity-50",disabled:!t.userId||m===t.userId,onClick:()=>t.userId&&h.mutate(t.userId),children:m===t.userId?e.jsx(k,{className:"h-4 w-4 animate-spin"}):e.jsx(ie,{className:"h-4 w-4"})})]})]},t.userId??t.userEmail??t.userName)),!c.length&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No members yet."})]})})]})]})]}),e.jsxs("section",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(f,{className:"rounded-3xl border-white/10 bg-white/5 overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-[#00ff73]/30 rounded-full -mr-16 -mt-16 pointer-events-none blur-lg"}),e.jsxs("div",{className:"p-6 relative z-10",children:[e.jsxs("h2",{className:"flex items-center gap-2 text-xl font-bold text-white mb-6",children:[e.jsx(le,{className:"h-5 w-5 text-primary"}),"Latest activity"]}),o.isPending?e.jsx(b,{className:"h-48 rounded-2xl bg-white/10"}):u.length?e.jsx("div",{className:"space-y-4",children:u.slice(0,4).map(t=>e.jsx(ge,{activity:t},t.entityId??t.eventName))}):e.jsx("p",{className:"text-sm text-gray-muted",children:"No activity yet."})]})]}),e.jsxs(f,{className:"rounded-3xl border-white/10 bg-white/5 overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-[#00ff73]/30 rounded-full -mr-16 -mt-16 pointer-events-none blur-lg"}),e.jsxs("div",{className:"p-6 relative z-10",children:[e.jsxs("h2",{className:"flex items-center gap-2 text-xl font-bold text-white mb-6",children:[e.jsx(ce,{className:"h-5 w-5 text-primary"}),"Highlights"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-2xl border border-white/5 bg-white/5 p-4",children:[e.jsx("p",{className:"text-sm text-white/70",children:"Current MVP"}),e.jsx("p",{className:"text-2xl font-semibold text-white",children:D(n==null?void 0:n.userInfo)}),e.jsxs("p",{className:"text-sm text-gray-muted",children:["Accuracy ",(n==null?void 0:n.accuracy)??"-"," • Earnings ",(n==null?void 0:n.earnings)??"-"]})]}),e.jsxs("div",{className:"rounded-2xl border border-white/5 bg-white/5 p-4",children:[e.jsx("p",{className:"text-sm text-white/70",children:"Members"}),e.jsx("p",{className:"text-2xl font-semibold text-white",children:p}),e.jsx("p",{className:"text-sm text-gray-muted",children:"Active participants in this clan"})]}),e.jsxs("div",{className:"rounded-2xl border border-white/5 bg-white/5 p-4",children:[e.jsx("p",{className:"text-sm text-white/70",children:"Last activity"}),e.jsx("p",{className:"text-lg text-white",children:$((G=u[0])==null?void 0:G.eventStartDate)})]})]})]})]})]})]})}):e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-black text-white",children:e.jsx("p",{children:"Clan not found."})})};export{ve as default};
